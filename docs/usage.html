<!DOCTYPE html>
    <!--
 | Generated by Apache Maven Doxia Site Renderer 1.8.1 at 2 May 2022 
 | Rendered using BloomReach Forge Maven Skin 3.1.1 based on Apache Maven Fluido Skin
-->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
                  <meta name="Date-Revision-yyyymmdd" content="20220502" />
              <meta http-equiv="Content-Language" content="en" />
      <title>Bloomreach IP Filter &#x2013; Using the IP Filter plugin</title>
  <link rel="stylesheet" href="./css/forge-maven-skin-syntaxhighlighter-3.1.1.min.css"/>
  <link rel="stylesheet" href="./css/forge-maven-skin-3.1.1.min.css"/>
  <link rel="stylesheet" href="./css/site.css" />
  <link rel="stylesheet" href="./css/print.css" media="print" />
  <link rel="icon" type="image/png" href="./images/skin/logo_64.png" sizes="64x64">

  
  <script type="text/javascript" src="./js/forge-maven-skin-syntaxhighlighter-3.1.1.min.js"></script>
  <script type="text/javascript" src="./js/forge-maven-skin-3.1.1.min.js"></script>

    </head>
<body class="topBarDisabled">
                        <a href="https://github.com/bloomreach-forge/ip-filter">
    <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
         src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"
         alt="Fork me on GitHub">
  </a>
          <div class="container-fluid">
  <div id="banner">
    <div id="logo">
                        <a href="https://bloomreach-forge.github.io">
        <img src="./images/skin/logo.png" alt="BloomReach Forge Logo" />
      </a>
    </div>
    <div class="pull-left">              <div id="bannerLeft">    <h1>Bloomreach Forge IP Filter Plugin</h1>
    </div>
              </div>
    <div class="pull-right"></div>
    <div class="clear"><hr/></div>
  </div>

  <div id="breadcrumbs">
                            <div class="links">
      <a href="https://documentation.bloomreach.com">documentation.bloomreach.com</a>
      <a href="https://developers.bloomreach.com">developers.bloomreach.com</a>
    </div>
    <ul class="breadcrumb">
    
  <li id="publishDate">published: 2 May 2022  
  </li>
  
        
            </ul>
    <div class="clear"><hr/></div>
  </div>
<div class="row-fluid">
  <div id="leftColumn" class="span2">
    <div class="well sidebar-nav">
    
    <ul class="nav nav-list">
            <li class="nav-header">Main</li>
              <li>  <a href="index.html" title="Introduction">  <span class="none"></span>  Introduction</a>  </li>
        <li>  <a href="install.html" title="Installation">  <span class="none"></span>  Installation</a>  </li>
        <li class="active">  <a href="#"><span class="none"></span>Usage</a>
  </li>
        <li>  <a href="release-notes.html" title="Release Notes">  <span class="none"></span>  Release Notes</a>  </li>
                  <li class="nav-header">Project</li>
                                                                                                                                                                                                          <li>  <a href="project-info.html" title="Project Information">  <span class="icon-chevron-right"></span>  Project Information</a>  </li>
        </ul>
    
          <hr />
      <div id="poweredBy">
                <div class="clear"></div>
                <div class="clear"></div>
                <div class="clear"></div>
                <div class="clear"></div>
              <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">  <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />  </a>
          </div>
    </div>
  </div>
  <div id="bodyColumn"  class="span10" >
    <!--
  Copyright 2017-2020 Bloomreach

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

   https://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
  -->
<div class="section">
<h2><a name="Using_the_IP_Filter_plugin"></a>Using the IP Filter plugin</h2>
<div class="section">
<h3><a name="Configuration"></a>Configuration</h3>
<p>During installation of IP Filter plugin, configuration for <tt>localhost</tt> is bootstrapped into <tt>/hippo:configuration/hippo:modules/ipfilter/hippo:moduleconfig/localhost</tt>. To make the configuration work on other environments, please make a copy of this node with a descriptive name like &#x2018;staging&#x2019; or &#x2018;production&#x2019;. Alternatively, if you want one configuration set, rename it to &#x2018;all-envs&#x2019;.</p>
<div class="section">
<h4><a name="Configuration_set_matching"></a>Configuration set matching</h4>
<p>By default, we match a host configuration set based on <b>X-Forwarded-Host</b> header. To override this, you can add an optional multi-valued string property named <b>forwarded-host-header</b>, containing additional header names. This property must be set on <b>hippo:moduleconfig</b> node and this setting is applied to all configurations. Please note that we always add <b>X-Forwarded-Host</b> by default.</p></div>
<div class="section">
<h4><a name="Properties_of_a_configuration_set"></a>Properties of a configuration set</h4>
<table border="0" class="table table-striped">
<thead>

<tr class="a">
<th>Property               </th>
<th> Type            </th>
<th> Default         </th>
<th> Description</th></tr>
</thead><tbody>

<tr class="b">
<td><tt>enabled</tt>              </td>
<td> boolean         </td>
<td> true            </td>
<td> Enable this configuration or not.</td></tr>
<tr class="a">
<td><tt>hostnames</tt>            </td>
<td> multiple string </td>
<td>                 </td>
<td> <b>Mandatory</b> list of hostnames, matching a browser request to this configuration set.</td></tr>
<tr class="b">
<td><tt>allowed-ip-ranges</tt>    </td>
<td> multiple string </td>
<td>                 </td>
<td> Whitelist of ip address <b>ranges</b> e.g. <b>2001:4cb8:29d:1::/64</b>. Controls access the both CMS as the site.</td></tr>
<tr class="a">
<td><tt>allow-cms-users</tt>      </td>
<td> boolean         </td>
<td> true            </td>
<td> To access the site, allow login with CMS credentials, with a basic authentication popup.</td></tr>
<tr class="b">
<td><tt>match-all</tt>            </td>
<td> boolean         </td>
<td> false           </td>
<td> To access the site, both IP address must be whitelisted and login with CMS credentials must be successful.</td></tr>
<tr class="a">
<td><tt>ignored-paths</tt>        </td>
<td> multiple string </td>
<td>                 </td>
<td> List of paths that are ignored by the filters, e.g. <b>/ping/.</b>*</td></tr>
<tr class="b">
<td><tt>forwarded-for-header</tt> </td>
<td> string          </td>
<td> X-Forwarded-For </td>
<td> Name of the request header that is used for forwarding.</td></tr>
<tr class="a">
<td><tt>cache-enabled</tt>        </td>
<td> boolean         </td>
<td> true            </td>
<td> Enabled by default, cache is used to store authenticated users.</td></tr>
</tbody>
</table>
<p><b>NOTES</b> - Both <tt>hostnames</tt> and <tt>ignored-paths</tt> must be regular expression escaped like  <b>*.onehippo\.org</b> or <b>127\.0\.0\.1</b> - Either <tt>allow-cms-users</tt> or <tt>allowed-ip-ranges</tt> must be enabled for a valid configuration.</p></div></div>
<div class="section">
<h3><a name="Multiple_optional_subconfigurations_for_special_headers"></a>Multiple optional subconfigurations for special headers</h3>
<p>Below a configuration set node, there may be any number of subnodes of type <tt>hipposys:moduleconfig</tt>, named freely but descriptively, for example &#x201c;ignore-fastly&#x201d;. Such node has the following properties:</p>
<table border="0" class="table table-striped">
<thead>

<tr class="a">
<th>Property                  </th>
<th> Type            </th>
<th> Description</th></tr>
</thead><tbody>

<tr class="b">
<td><tt>ignored-header</tt>        </td>
<td> string          </td>
<td> Name of header to ignore, for example &#x2018;X-fastly&#x2019;.</td></tr>
<tr class="a">
<td><tt>ignored-header-values</tt> </td>
<td> multiple string </td>
<td> Values of <b>ignored-header</b> that must be matched for the request to be ignored by the filter.</td></tr>
</tbody>
</table></div>
<div class="section">
<h3><a name="External_properties_file_for_default_set_up"></a>External properties file for default set up</h3>
<p>Since version 2.2.0, an external properties file <tt>hippo-ipfilter.properties</tt> can be fed to the filters by either using a system property (by the same name) or just dropping it in Tomcat&#x2019;s conf directory. It supports values for the <tt>allowed-ip-ranges</tt> and <tt>ignored-paths</tt> properties.</p>
<p>Default <tt>hippo-ipfilter.properties</tt> file:</p>

<div>
<div>
<pre class="source">#
# Configuration file for Hippo IP Filter Plugin.
#
# Set up this file for Hippo CMS and/or site application using either:
# - system property -Dhippo-ipfilter.properties=file://hostname/path (hostname may be omitted if localhost)
# - placement in ${catalina.base}/conf
# - placement in ${catalina.home}/conf
#
# This file supports these properties:
#  - allowed-ip-ranges: comma separated whitelist of ip address ranges
#  - ignored-paths: comma separated paths that are ignored
#
allowed-ip-ranges=127.0.0.1,0:0:0:0:0:0:0:1
ignored-paths=/ping/.*
</pre></div></div>
</div>
<div class="section">
<h3><a name="System_properties_to_disable_the_filters"></a>System properties to disable the filters</h3>
<p>For recovery purposes, should administrators have locked everybody out of the CMS/console by misconfiguration, the possibility exists to disable the filters by setting system properties.</p>
<table border="0" class="table table-striped">
<thead>

<tr class="a">
<th>System Property               </th>
<th> Description</th></tr>
</thead><tbody>

<tr class="b">
<td><tt>hippo.cms-ipfilter.disabled</tt> </td>
<td> Disables the CMS&#x2019;s <tt>org.onehippo.forge.ipfilter.cms.CmsIpFilter</tt></td></tr>
<tr class="a">
<td><tt>hippo.ipfilter.disabled</tt>     </td>
<td> Disables the site&#x2019;s <tt>org.onehippo.forge.ipfilter.hst.IpFilter</tt></td></tr>
</tbody>
</table></div></div>
    </div>
    </div>
    </div>
    <hr/>
    <footer>
    <div class="container-fluid">
      <div class="row-fluid">
          <p class="copyright">Copyright &copy;      2016&#x2013;2022
              <a href="https://www.bloomreach.com/">Bloomreach</a>.
          
</p>
    </div>
            </div>
  </footer>
    </body>
</html>

